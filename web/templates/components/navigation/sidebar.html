{{/*
  Sidebar Component

  Vertical navigation sidebar with sections, items, and optional header/footer.

  Components:
    - sidebar-start/end: Container nav element
    - sidebar-header-start/end: Top section (logo, branding)
    - sidebar-body-start/end: Main scrollable content area
    - sidebar-footer-start/end: Bottom section (user menu, settings)
    - sidebar-section-start/end: Group of related items
    - sidebar-heading: Section heading text
    - sidebar-item: Navigation item (link or button)
    - sidebar-divider: Visual separator
    - sidebar-spacer: Flexible spacer to push content down

  Usage:
    {{template "sidebar-start"}}
      {{template "sidebar-header-start"}}
        <a href="/" class="flex items-center gap-2">
          <img src="/logo.svg" alt="Logo" class="h-8">
          <span class="font-semibold">Lukaut</span>
        </a>
      {{template "sidebar-header-end"}}

      {{template "sidebar-body-start"}}
        {{template "sidebar-section-start"}}
          {{template "sidebar-item" dict "href" "/dashboard" "icon" "home" "text" "Dashboard" "current" true}}
          {{template "sidebar-item" dict "href" "/inspections" "icon" "clipboard-document-list" "text" "Inspections"}}
          {{template "sidebar-item" dict "href" "/reports" "icon" "document-text" "text" "Reports"}}
        {{template "sidebar-section-end"}}

        {{template "sidebar-spacer"}}

        {{template "sidebar-section-start"}}
          {{template "sidebar-heading" dict "text" "Settings"}}
          {{template "sidebar-item" dict "href" "/settings" "icon" "cog-6-tooth" "text" "Settings"}}
        {{template "sidebar-section-end"}}
      {{template "sidebar-body-end"}}

      {{template "sidebar-footer-start"}}
        {{template "sidebar-item" dict "href" "/account" "icon" "user" "text" "John Doe"}}
      {{template "sidebar-footer-end"}}
    {{template "sidebar-end"}}
*/}}

{{define "sidebar-start"}}
<nav class="flex h-full min-h-0 flex-col {{.class}}">
{{end}}

{{define "sidebar-end"}}
</nav>
{{end}}

{{/*
  Sidebar Header

  Top section for logo, branding, or user avatar.
*/}}
{{define "sidebar-header-start"}}
<div class="flex flex-col border-b border-[var(--color-zinc-950)]/5 p-4 [&>[data-slot=section]+[data-slot=section]]:mt-2.5 {{.class}}">
{{end}}

{{define "sidebar-header-end"}}
</div>
{{end}}

{{/*
  Sidebar Body

  Main scrollable content area for navigation items.
*/}}
{{define "sidebar-body-start"}}
<div class="flex flex-1 flex-col overflow-y-auto p-4 [&>[data-slot=section]+[data-slot=section]]:mt-8 {{.class}}">
{{end}}

{{define "sidebar-body-end"}}
</div>
{{end}}

{{/*
  Sidebar Footer

  Bottom section for user menu, logout, etc.
*/}}
{{define "sidebar-footer-start"}}
<div class="flex flex-col border-t border-[var(--color-zinc-950)]/5 p-4 [&>[data-slot=section]+[data-slot=section]]:mt-2.5 {{.class}}">
{{end}}

{{define "sidebar-footer-end"}}
</div>
{{end}}

{{/*
  Sidebar Section

  Container for a group of related items.
*/}}
{{define "sidebar-section-start"}}
<div data-slot="section" class="flex flex-col gap-0.5 {{.class}}">
{{end}}

{{define "sidebar-section-end"}}
</div>
{{end}}

{{/*
  Sidebar Heading

  Section heading text.

  Params:
    text  - Heading text
    class - Additional CSS classes
*/}}
{{define "sidebar-heading"}}
<h3 class="mb-1 px-2 text-xs/6 font-medium text-[var(--color-text-tertiary)] {{.class}}">
  {{.text}}
</h3>
{{end}}

{{/*
  Sidebar Item

  Navigation link or button.

  Params:
    href    - URL (makes it a link)
    text    - Item label
    icon    - Icon name (optional)
    current - Boolean, marks as current page
    badge   - Badge text (optional, shows count/status)
    onclick - Click handler (for button items)
    class   - Additional CSS classes

    htmx attributes:
    hxGet, hxPost, hxTarget, hxSwap

  Usage:
    {{template "sidebar-item" dict "href" "/dashboard" "icon" "home" "text" "Dashboard" "current" true}}
    {{template "sidebar-item" dict "href" "/inbox" "icon" "inbox" "text" "Inbox" "badge" "12"}}
*/}}
{{define "sidebar-item"}}
{{- $current := or .current false -}}
{{- $tag := "button" -}}
{{- if .href }}{{- $tag = "a" -}}{{end}}

<span class="relative {{.class}}">
  {{if $current}}
  <span class="absolute inset-y-2 -left-4 w-0.5 rounded-full bg-[var(--color-text)]"></span>
  {{end}}

  <{{$tag}} {{if .href}}href="{{.href}}"{{else}}type="button"{{end}}
       {{if and (not .href) .onclick}}onclick="{{.onclick}}"{{end}}
       {{if .hxGet}}hx-get="{{.hxGet}}"{{end}}
       {{if .hxPost}}hx-post="{{.hxPost}}"{{end}}
       {{if .hxTarget}}hx-target="{{.hxTarget}}"{{end}}
       {{if .hxSwap}}hx-swap="{{.hxSwap}}"{{end}}
       {{if $current}}data-current="true"{{end}}
       class="flex w-full items-center gap-3 rounded-lg px-2 py-2.5 text-left text-base/6 font-medium text-[var(--color-text)] sm:py-2 sm:text-sm/5
              hover:bg-[var(--color-zinc-950)]/5
              focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-primary)]
              {{if $current}}bg-[var(--color-zinc-950)]/[0.025]{{end}}">
    {{if .icon}}
    <span class="size-6 sm:size-5 shrink-0 text-[var(--color-text-tertiary)] {{if $current}}text-[var(--color-text)]{{end}}">
      {{template "icon" dict "name" .icon "size" "md"}}
    </span>
    {{end}}
    <span class="truncate flex-1">{{.text}}</span>
    {{if .badge}}
    <span class="ml-auto inline-flex items-center rounded-full bg-[var(--color-zinc-100)] px-2 py-0.5 text-xs font-medium text-[var(--color-text-secondary)]">
      {{.badge}}
    </span>
    {{end}}
  </{{$tag}}>
</span>
{{end}}

{{/*
  Sidebar Divider

  Horizontal line separator between sections.
*/}}
{{define "sidebar-divider"}}
<hr class="my-4 border-t border-[var(--color-zinc-950)]/5 lg:-mx-4 {{.class}}">
{{end}}

{{/*
  Sidebar Spacer

  Flexible space to push subsequent content to the bottom.
*/}}
{{define "sidebar-spacer"}}
<div aria-hidden="true" class="mt-8 flex-1 {{.class}}"></div>
{{end}}

{{/*
  Sidebar Label

  Text label inside an item (for more control).
*/}}
{{define "sidebar-label"}}
<span class="truncate {{.class}}">{{.text}}</span>
{{end}}

{{/*
  Sidebar Collapsible Section

  Section that can be expanded/collapsed with Alpine.js.

  Params:
    heading - Section heading text
    open    - Boolean, initial open state (default: false)
    class   - Additional CSS classes

  Usage:
    {{template "sidebar-collapsible-start" dict "heading" "Reports" "open" true}}
      {{template "sidebar-item" dict "href" "/reports/weekly" "text" "Weekly"}}
      {{template "sidebar-item" dict "href" "/reports/monthly" "text" "Monthly"}}
    {{template "sidebar-collapsible-end"}}
*/}}
{{define "sidebar-collapsible-start"}}
{{- $open := or .open false -}}
<div data-slot="section" x-data="{ open: {{$open}} }" class="flex flex-col {{.class}}">
  <button type="button"
          @click="open = !open"
          class="flex w-full items-center justify-between px-2 py-1.5 text-xs/6 font-medium text-[var(--color-text-tertiary)] hover:text-[var(--color-text)]">
    <span>{{.heading}}</span>
    <svg class="size-4 transition-transform" :class="open ? 'rotate-90' : ''" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"/>
    </svg>
  </button>
  <div x-show="open" x-collapse class="flex flex-col gap-0.5 mt-1">
{{end}}

{{define "sidebar-collapsible-end"}}
  </div>
</div>
{{end}}
