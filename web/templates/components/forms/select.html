{{/*
  Select Component

  Native select dropdown with consistent styling.

  Params:
    name     - Select name attribute (required)
    id       - Select ID (defaults to name if not provided)
    options  - Slice of options: [{value: "val", label: "Label", selected: bool, disabled: bool}]
    value    - Currently selected value (alternative to marking option as selected)
    required - Boolean, marks field as required
    disabled - Boolean, disables the select
    invalid  - Boolean, shows invalid state (red border)
    multiple - Boolean, allows multiple selection
    size     - Number of visible options when multiple (default: 4 for multiple)
    class    - Additional CSS classes for the wrapper
    selectClass - Additional CSS classes for the select element
    ariaDescribedby - ID of element describing this select (for errors)
    placeholder - Placeholder text (creates disabled first option)

    htmx attributes:
    hxGet, hxPost, hxTrigger, hxTarget, hxSwap

  Usage:
    {{template "select" dict "name" "country" "options" .Countries "placeholder" "Select a country"}}

    {{template "select" dict "name" "role" "options" (list
      (dict "value" "admin" "label" "Administrator")
      (dict "value" "user" "label" "Regular User")
      (dict "value" "guest" "label" "Guest")
    ) "value" .CurrentRole}}

    {{template "select" dict "name" "tags" "options" .Tags "multiple" true}}
*/}}

{{define "select"}}
{{- $id := or .id .name -}}
{{- $multiple := or .multiple false -}}
{{- $invalid := or .invalid false -}}
{{- $disabled := or .disabled false -}}
{{- $value := .value -}}

<span data-slot="control"
      class="group relative block w-full before:absolute before:inset-px before:rounded-[calc(var(--radius-lg)-1px)] before:bg-white before:shadow-sm after:pointer-events-none after:absolute after:inset-0 after:rounded-lg after:ring-transparent after:ring-inset has-[:focus]:after:ring-2 has-[:focus]:after:ring-[var(--color-primary)] {{if $disabled}}opacity-50 before:bg-[var(--color-zinc-950-5)] before:shadow-none{{end}} {{.class}}">
  <select name="{{.name}}"
          id="{{$id}}"
          {{if .required}}required{{end}}
          {{if $disabled}}disabled{{end}}
          {{if $multiple}}multiple{{end}}
          {{if and $multiple .size}}size="{{.size}}"{{else if $multiple}}size="4"{{end}}
          {{if .ariaDescribedby}}aria-describedby="{{.ariaDescribedby}}"{{end}}
          {{if $invalid}}aria-invalid="true"{{end}}
          {{if .hxGet}}hx-get="{{.hxGet}}"{{end}}
          {{if .hxPost}}hx-post="{{.hxPost}}"{{end}}
          {{if .hxTrigger}}hx-trigger="{{.hxTrigger}}"{{end}}
          {{if .hxTarget}}hx-target="{{.hxTarget}}"{{end}}
          {{if .hxSwap}}hx-swap="{{.hxSwap}}"{{end}}
          class="relative block w-full appearance-none rounded-lg py-2.5 sm:py-1.5 {{if $multiple}}px-3.5 sm:px-3{{else}}pl-3.5 pr-10 sm:pl-3 sm:pr-9{{end}} text-base/6 text-[var(--color-text)] sm:text-sm/6 border bg-transparent focus:outline-none [&_optgroup]:font-semibold {{if $invalid}}border-[var(--color-danger)] hover:border-[var(--color-danger)]{{else}}border-[var(--color-border)] hover:border-[var(--color-border-hover)]{{end}} {{if $disabled}}border-[var(--color-border-strong)] cursor-not-allowed{{end}} {{.selectClass}}">
    {{if .placeholder}}
    <option value="" disabled {{if not $value}}selected{{end}}>{{.placeholder}}</option>
    {{end}}
    {{range .options}}
    <option value="{{.value}}"
            {{if .disabled}}disabled{{end}}
            {{if or .selected (eq .value $value)}}selected{{end}}>
      {{.label}}
    </option>
    {{end}}
  </select>
  {{if not $multiple}}
  <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
    <svg class="size-5 stroke-[var(--color-text-tertiary)] group-has-[:disabled]:stroke-[var(--color-text-tertiary)] sm:size-4"
         viewBox="0 0 16 16"
         aria-hidden="true"
         fill="none">
      <path d="M5.75 10.75L8 13L10.25 10.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M10.25 5.25L8 3L5.75 5.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </span>
  {{end}}
</span>
{{end}}

{{/*
  Select with Optgroups

  For selects that need option grouping.

  Params:
    name     - Select name attribute (required)
    id       - Select ID
    groups   - Slice of groups: [{label: "Group", options: [{value, label, selected, disabled}]}]
    ... other params same as select

  Usage:
    {{template "select-grouped" dict "name" "timezone" "groups" (list
      (dict "label" "North America" "options" (list
        (dict "value" "est" "label" "Eastern Time")
        (dict "value" "cst" "label" "Central Time")
      ))
      (dict "label" "Europe" "options" (list
        (dict "value" "gmt" "label" "GMT")
        (dict "value" "cet" "label" "Central European")
      ))
    )}}
*/}}
{{define "select-grouped"}}
{{- $id := or .id .name -}}
{{- $multiple := or .multiple false -}}
{{- $invalid := or .invalid false -}}
{{- $disabled := or .disabled false -}}
{{- $value := .value -}}

<span data-slot="control"
      class="group relative block w-full before:absolute before:inset-px before:rounded-[calc(var(--radius-lg)-1px)] before:bg-white before:shadow-sm after:pointer-events-none after:absolute after:inset-0 after:rounded-lg after:ring-transparent after:ring-inset has-[:focus]:after:ring-2 has-[:focus]:after:ring-[var(--color-primary)] {{if $disabled}}opacity-50 before:bg-[var(--color-zinc-950-5)] before:shadow-none{{end}} {{.class}}">
  <select name="{{.name}}"
          id="{{$id}}"
          {{if .required}}required{{end}}
          {{if $disabled}}disabled{{end}}
          {{if $multiple}}multiple{{end}}
          {{if and $multiple .size}}size="{{.size}}"{{else if $multiple}}size="4"{{end}}
          {{if .ariaDescribedby}}aria-describedby="{{.ariaDescribedby}}"{{end}}
          {{if $invalid}}aria-invalid="true"{{end}}
          class="relative block w-full appearance-none rounded-lg py-2.5 sm:py-1.5 {{if $multiple}}px-3.5 sm:px-3{{else}}pl-3.5 pr-10 sm:pl-3 sm:pr-9{{end}} text-base/6 text-[var(--color-text)] sm:text-sm/6 border bg-transparent focus:outline-none [&_optgroup]:font-semibold {{if $invalid}}border-[var(--color-danger)]{{else}}border-[var(--color-border)] hover:border-[var(--color-border-hover)]{{end}} {{.selectClass}}">
    {{if .placeholder}}
    <option value="" disabled {{if not $value}}selected{{end}}>{{.placeholder}}</option>
    {{end}}
    {{range .groups}}
    <optgroup label="{{.label}}">
      {{range .options}}
      <option value="{{.value}}"
              {{if .disabled}}disabled{{end}}
              {{if or .selected (eq .value $value)}}selected{{end}}>
        {{.label}}
      </option>
      {{end}}
    </optgroup>
    {{end}}
  </select>
  {{if not $multiple}}
  <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
    <svg class="size-5 stroke-[var(--color-text-tertiary)] sm:size-4"
         viewBox="0 0 16 16"
         aria-hidden="true"
         fill="none">
      <path d="M5.75 10.75L8 13L10.25 10.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M10.25 5.25L8 3L5.75 5.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </span>
  {{end}}
</span>
{{end}}
