{{/*
  Flash Message Component

  Dismissible notification banners for success, error, warning, and info messages.
  Uses Alpine.js for auto-dismiss and manual close functionality.

  Components:
    - flash: Renders flash message if present in context
    - flash-message: Standalone flash message with explicit params

  Params for flash:
    .Flash.Type    - Message type: success, error, warning, info
    .Flash.Message - Message text

  Params for flash-message:
    type    - Message type: success, error, warning, info
    message - Message text
    dismiss - Boolean, show dismiss button (default: true)
    autoDismiss - Seconds before auto-dismiss (default: 0 = no auto-dismiss)
    class   - Additional CSS classes

  Usage (context-based):
    {{template "flash" .}}

  Usage (explicit):
    {{template "flash-message" dict "type" "success" "message" "Changes saved successfully!"}}
    {{template "flash-message" dict "type" "error" "message" "Something went wrong." "autoDismiss" 5}}
*/}}

{{define "flash"}}
{{if .Flash}}
{{template "flash-message" dict "type" .Flash.Type "message" .Flash.Message}}
{{end}}
{{end}}

{{define "flash-message"}}
{{- $type := or .type "info" -}}
{{- $dismiss := true -}}
{{- if eq .dismiss false}}{{$dismiss = false}}{{end}}
{{- $autoDismiss := or .autoDismiss 0 -}}
<div x-data="{ show: true {{if gt $autoDismiss 0}}, init() { setTimeout(() => this.show = false, {{$autoDismiss}}000) }{{end}} }"
     x-show="show"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 -translate-y-2"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 -translate-y-2"
     class="mb-6 rounded-lg p-4 {{.class}}
            {{if eq $type "error"}}bg-[var(--color-danger-subtle)] border border-[var(--color-danger)]/20{{end}}
            {{if eq $type "success"}}bg-[var(--color-success-subtle)] border border-[var(--color-success)]/20{{end}}
            {{if eq $type "warning"}}bg-[var(--color-warning-subtle)] border border-[var(--color-warning)]/20{{end}}
            {{if eq $type "info"}}bg-[var(--color-info-subtle)] border border-[var(--color-info)]/20{{end}}"
     role="alert">
  <div class="flex">
    <div class="flex-shrink-0">
      {{if eq $type "error"}}
      <svg class="h-5 w-5 text-[var(--color-danger)]" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
      </svg>
      {{end}}
      {{if eq $type "success"}}
      <svg class="h-5 w-5 text-[var(--color-success)]" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
      </svg>
      {{end}}
      {{if eq $type "warning"}}
      <svg class="h-5 w-5 text-[var(--color-warning)]" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
      </svg>
      {{end}}
      {{if eq $type "info"}}
      <svg class="h-5 w-5 text-[var(--color-info)]" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
      </svg>
      {{end}}
    </div>
    <div class="ml-3 flex-1">
      <p class="text-sm font-medium
                {{if eq $type "error"}}text-[var(--color-danger)]{{end}}
                {{if eq $type "success"}}text-[var(--color-success)]{{end}}
                {{if eq $type "warning"}}text-[var(--color-amber-800)]{{end}}
                {{if eq $type "info"}}text-[var(--color-info)]{{end}}">
        {{.message}}
      </p>
    </div>
    {{if $dismiss}}
    <div class="ml-auto pl-3">
      <button type="button"
              @click="show = false"
              class="-mx-1.5 -my-1.5 inline-flex rounded-md p-1.5
                     {{if eq $type "error"}}text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10{{end}}
                     {{if eq $type "success"}}text-[var(--color-success)] hover:bg-[var(--color-success)]/10{{end}}
                     {{if eq $type "warning"}}text-[var(--color-warning)] hover:bg-[var(--color-warning)]/10{{end}}
                     {{if eq $type "info"}}text-[var(--color-info)] hover:bg-[var(--color-info)]/10{{end}}
                     focus:outline-none focus:ring-2 focus:ring-offset-2
                     {{if eq $type "error"}}focus:ring-[var(--color-danger)]{{end}}
                     {{if eq $type "success"}}focus:ring-[var(--color-success)]{{end}}
                     {{if eq $type "warning"}}focus:ring-[var(--color-warning)]{{end}}
                     {{if eq $type "info"}}focus:ring-[var(--color-info)]{{end}}">
        <span class="sr-only">Dismiss</span>
        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    {{end}}
  </div>
</div>
{{end}}

{{/*
  Toast Notification

  Floating toast notification that appears in a corner of the screen.
  Best used with htmx hx-swap="beforeend" to #toast-container.

  Params:
    type    - Message type: success, error, warning, info
    title   - Toast title (optional)
    message - Message text
    autoDismiss - Seconds before auto-dismiss (default: 5)

  Usage:
    <!-- Container in layout -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Individual toast -->
    {{template "toast" dict "type" "success" "title" "Saved" "message" "Your changes have been saved."}}
*/}}
{{define "toast"}}
{{- $type := or .type "info" -}}
{{- $autoDismiss := or .autoDismiss 5 -}}
<div x-data="{ show: true, init() { setTimeout(() => { this.show = false; setTimeout(() => this.$el.remove(), 300) }, {{$autoDismiss}}000) } }"
     x-show="show"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 translate-x-4"
     x-transition:enter-end="opacity-100 translate-x-0"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 translate-x-0"
     x-transition:leave-end="opacity-0 translate-x-4"
     class="pointer-events-auto w-full max-w-sm overflow-hidden rounded-lg bg-white shadow-lg ring-1 ring-[var(--color-zinc-950)]/5">
  <div class="p-4">
    <div class="flex items-start">
      <div class="flex-shrink-0">
        {{if eq $type "success"}}
        <svg class="h-6 w-6 text-[var(--color-success)]" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        {{end}}
        {{if eq $type "error"}}
        <svg class="h-6 w-6 text-[var(--color-danger)]" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>
        {{end}}
        {{if eq $type "warning"}}
        <svg class="h-6 w-6 text-[var(--color-warning)]" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        {{end}}
        {{if eq $type "info"}}
        <svg class="h-6 w-6 text-[var(--color-info)]" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
        </svg>
        {{end}}
      </div>
      <div class="ml-3 w-0 flex-1 pt-0.5">
        {{if .title}}
        <p class="text-sm font-medium text-[var(--color-text)]">{{.title}}</p>
        {{end}}
        <p class="{{if .title}}mt-1{{end}} text-sm text-[var(--color-text-secondary)]">{{.message}}</p>
      </div>
      <div class="ml-4 flex flex-shrink-0">
        <button type="button"
                @click="show = false; setTimeout(() => $el.closest('[x-data]').remove(), 300)"
                class="inline-flex rounded-md text-[var(--color-text-tertiary)] hover:text-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:ring-offset-2">
          <span class="sr-only">Close</span>
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
{{end}}

{{/*
  Toast Container

  Fixed container for toast notifications.
  Place this in your layout template.

  Params:
    position - Container position: top-right (default), top-left, bottom-right, bottom-left

  Usage:
    {{template "toast-container" dict "position" "bottom-right"}}
*/}}
{{define "toast-container"}}
{{- $position := or .position "top-right" -}}
<div id="toast-container"
     aria-live="assertive"
     class="pointer-events-none fixed inset-0 z-50 flex flex-col gap-2 px-4 py-6 sm:p-6
            {{if eq $position "top-right"}}items-end justify-start{{end}}
            {{if eq $position "top-left"}}items-start justify-start{{end}}
            {{if eq $position "bottom-right"}}items-end justify-end{{end}}
            {{if eq $position "bottom-left"}}items-start justify-end{{end}}">
</div>
{{end}}
