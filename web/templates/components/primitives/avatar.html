{{/*
  Avatar Component

  User profile picture with fallback to initials.

  Params:
    src      - Image URL (optional, shows initials if not provided)
    initials - Fallback initials, 1-2 characters (optional)
    alt      - Alt text for the image (optional)
    size     - Size: "xs", "sm", "md" (default), "lg", "xl"
    square   - Boolean, use rounded square instead of circle (default: false)
    class    - Additional CSS classes (optional)

  Usage:
    {{template "avatar" dict "src" "/images/user.jpg" "alt" "John Doe"}}
    {{template "avatar" dict "initials" "JD" "size" "lg"}}
    {{template "avatar" dict "src" "/images/company.png" "square" true "size" "sm"}}
*/}}

{{define "avatar"}}
{{- $size := or .size "md" -}}
{{- $square := or .square false -}}

{{- /* Size classes */ -}}
{{- $sizeClass := "" -}}
{{- if eq $size "xs" -}}
  {{- $sizeClass = "size-6" -}}
{{- else if eq $size "sm" -}}
  {{- $sizeClass = "size-8" -}}
{{- else if eq $size "md" -}}
  {{- $sizeClass = "size-10" -}}
{{- else if eq $size "lg" -}}
  {{- $sizeClass = "size-12" -}}
{{- else if eq $size "xl" -}}
  {{- $sizeClass = "size-16" -}}
{{- else -}}
  {{- $sizeClass = "size-10" -}}
{{- end -}}

{{- /* Border radius */ -}}
{{- $radiusClass := "rounded-full *:rounded-full" -}}
{{- if $square -}}
  {{- $radiusClass = "rounded-[20%] *:rounded-[20%]" -}}
{{- end -}}

<span data-slot="avatar"
      class="inline-grid shrink-0 align-middle *:col-start-1 *:row-start-1 outline -outline-offset-1 outline-black/10 {{$sizeClass}} {{$radiusClass}} {{.class}}">
  {{if .initials}}
  <svg class="size-full fill-current p-[5%] text-[48px] font-medium uppercase select-none bg-[var(--color-surface-inset)] text-[var(--color-text-secondary)]"
       viewBox="0 0 100 100"
       {{if .alt}}aria-label="{{.alt}}"{{else}}aria-hidden="true"{{end}}>
    {{if .alt}}<title>{{.alt}}</title>{{end}}
    <text x="50%" y="50%" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" dy=".125em">
      {{.initials}}
    </text>
  </svg>
  {{end}}
  {{if .src}}
  <img class="size-full object-cover" src="{{.src}}" alt="{{or .alt ""}}">
  {{end}}
</span>
{{end}}

{{/*
  AvatarButton - Clickable avatar that links or triggers action

  Params:
    src      - Image URL (optional)
    initials - Fallback initials (optional)
    alt      - Alt text (optional)
    size     - Size variant (optional)
    square   - Use square shape (optional)
    href     - Link destination (renders as anchor)
    class    - Additional CSS classes (optional)

  Usage:
    {{template "avatar-button" dict "src" "/images/user.jpg" "href" "/profile"}}
*/}}
{{define "avatar-button"}}
{{- $square := or .square false -}}
{{- $radiusClass := "rounded-full" -}}
{{- if $square -}}
  {{- $radiusClass = "rounded-[20%]" -}}
{{- end -}}

<a href="{{.href}}"
   class="relative inline-grid focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[var(--color-primary)] {{$radiusClass}} {{.class}}">
  {{template "avatar" dict "src" .src "initials" .initials "alt" .alt "size" .size "square" .square}}
</a>
{{end}}
