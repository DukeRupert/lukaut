{{define "regulation_detail"}}
<div>
    <!-- Header with close button -->
    <div class="flex items-start justify-between mb-4">
        <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-navy text-white">
                    {{.Regulation.StandardNumber}}
                </span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    {{.Regulation.Category}}
                </span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900" id="modal-title">
                {{.Regulation.Title}}
            </h3>
            {{if .Regulation.Subcategory}}
            <p class="mt-1 text-sm text-gray-500">{{.Regulation.Subcategory}}</p>
            {{end}}
        </div>
        <button type="button" @click="modalOpen = false" class="ml-4 text-gray-400 hover:text-gray-500">
            <span class="sr-only">Close</span>
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>

    <!-- Summary -->
    {{if .Regulation.Summary}}
    <div class="mb-4 p-3 bg-blue-50 rounded-md">
        <h4 class="text-sm font-medium text-blue-900 mb-1">Summary</h4>
        <p class="text-sm text-blue-800">{{.Regulation.Summary}}</p>
    </div>
    {{end}}

    <!-- Severity -->
    {{if .Regulation.SeverityTypical}}
    <div class="mb-4">
        <span class="text-sm font-medium text-gray-700">Typical Severity: </span>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
            {{if eq .Regulation.SeverityTypical "critical"}}bg-red-100 text-red-800
            {{else if eq .Regulation.SeverityTypical "serious"}}bg-orange-100 text-orange-800
            {{else if eq .Regulation.SeverityTypical "moderate"}}bg-yellow-100 text-yellow-800
            {{else}}bg-gray-100 text-gray-800{{end}}">
            {{title .Regulation.SeverityTypical}}
        </span>
    </div>
    {{end}}

    <!-- Full Text -->
    <div class="mb-4">
        <h4 class="text-sm font-medium text-gray-900 mb-2">Full Regulation Text</h4>
        <div class="max-h-96 overflow-y-auto prose prose-sm max-w-none bg-gray-50 rounded-md p-4">
            <div class="whitespace-pre-wrap text-sm text-gray-700">{{.Regulation.FullText}}</div>
        </div>
    </div>

    <!-- Metadata -->
    <div class="border-t border-gray-200 pt-4 mb-4">
        <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
            {{if .Regulation.ParentStandard}}
            <div>
                <dt class="text-xs font-medium text-gray-500">Parent Standard</dt>
                <dd class="mt-1 text-sm text-gray-900">{{.Regulation.ParentStandard}}</dd>
            </div>
            {{end}}
            {{if .Regulation.EffectiveDate}}
            <div>
                <dt class="text-xs font-medium text-gray-500">Effective Date</dt>
                <dd class="mt-1 text-sm text-gray-900">{{formatDate .Regulation.EffectiveDate}}</dd>
            </div>
            {{end}}
            {{if .Regulation.LastUpdated}}
            <div>
                <dt class="text-xs font-medium text-gray-500">Last Updated</dt>
                <dd class="mt-1 text-sm text-gray-900">{{formatDate .Regulation.LastUpdated}}</dd>
            </div>
            {{end}}
        </dl>
    </div>

    <!-- Actions -->
    <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200">
        <button
            type="button"
            @click="modalOpen = false"
            class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
            Close
        </button>

        {{if .ViolationID}}
            {{if .AlreadyLinked}}
            <!-- Remove from Violation Button -->
            <button
                type="button"
                hx-delete="/violations/{{.ViolationID}}/regulations/{{.Regulation.ID}}"
                hx-confirm="Are you sure you want to remove this regulation from the violation?"
                hx-swap="none"
                class="rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600">
                Remove from Violation
            </button>
            {{else}}
            <!-- Add to Violation Button -->
            <button
                type="button"
                hx-post="/violations/{{.ViolationID}}/regulations/{{.Regulation.ID}}"
                hx-swap="none"
                class="rounded-md bg-navy px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-navy/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-navy">
                Add to Violation
            </button>
            {{end}}
        {{end}}
    </div>
</div>
{{end}}
