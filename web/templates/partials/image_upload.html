{{define "image_upload.html"}}
<div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:p-6">
        <h3 class="text-base font-semibold leading-6 text-gray-900">Upload Site Photos</h3>
        <div class="mt-2 text-sm text-gray-500">
            <p>Upload photos of the construction site for AI analysis. Supported formats: JPEG, PNG. Max size: 20MB per file.</p>
        </div>

        <div class="mt-5"
             x-data="{
                 isDragging: false,
                 isUploading: false,
                 progress: 0,
                 handleFiles(files) {
                     if (!files || files.length === 0) return;
                     this.uploadFiles(files);
                 },
                 uploadFiles(files) {
                     this.isUploading = true;
                     this.progress = 0;

                     const formData = new FormData();
                     for (let i = 0; i < files.length; i++) {
                         formData.append('images', files[i]);
                     }

                     const xhr = new XMLHttpRequest();

                     xhr.upload.addEventListener('progress', (e) => {
                         if (e.lengthComputable) {
                             this.progress = Math.round((e.loaded / e.total) * 100);
                         }
                     });

                     xhr.addEventListener('load', () => {
                         this.isUploading = false;
                         this.progress = 0;
                         if (xhr.status === 200) {
                             // Replace gallery with response
                             document.getElementById('image-gallery').innerHTML = xhr.responseText;
                         } else {
                             alert('Upload failed. Please try again.');
                         }
                     });

                     xhr.addEventListener('error', () => {
                         this.isUploading = false;
                         this.progress = 0;
                         alert('Upload failed. Please check your connection and try again.');
                     });

                     xhr.open('POST', '/inspections/{{.InspectionID}}/images');
                     xhr.send(formData);
                 }
             }">

            <!-- Drag and drop zone -->
            <div class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10"
                 :class="{ 'bg-blue-50 border-blue-400': isDragging }"
                 @dragover.prevent="isDragging = true"
                 @dragleave.prevent="isDragging = false"
                 @drop.prevent="isDragging = false; handleFiles($event.dataTransfer.files)">
                <div class="text-center">
                    <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" />
                    </svg>
                    <div class="mt-4 flex text-sm leading-6 text-gray-600">
                        <label for="file-upload" class="relative cursor-pointer rounded-md bg-white font-semibold text-navy focus-within:outline-none focus-within:ring-2 focus-within:ring-navy focus-within:ring-offset-2 hover:text-navy/80">
                            <span>Upload files</span>
                            <input id="file-upload"
                                   name="images"
                                   type="file"
                                   class="sr-only"
                                   multiple
                                   accept="image/jpeg,image/png"
                                   @change="handleFiles($event.target.files)">
                        </label>
                        <p class="pl-1">or drag and drop</p>
                    </div>
                    <p class="text-xs leading-5 text-gray-600">JPEG, PNG up to 20MB each</p>
                </div>
            </div>

            <!-- Progress bar -->
            <div x-show="isUploading" class="mt-4">
                <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">Uploading...</span>
                    <span class="text-sm font-medium text-gray-700" x-text="progress + '%'"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-navy h-2.5 rounded-full transition-all duration-300"
                         :style="'width: ' + progress + '%'"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{{end}}
