// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: violations.sql

package repository

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
	"github.com/sqlc-dev/pqtype"
)

const countViolationsByInspectionID = `-- name: CountViolationsByInspectionID :one
SELECT COUNT(*) FROM violations
WHERE inspection_id = $1
`

func (q *Queries) CountViolationsByInspectionID(ctx context.Context, inspectionID uuid.UUID) (int64, error) {
	row := q.db.QueryRowContext(ctx, countViolationsByInspectionID, inspectionID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countViolationsByStatus = `-- name: CountViolationsByStatus :one
SELECT COUNT(*) FROM violations
WHERE inspection_id = $1 AND status = $2
`

type CountViolationsByStatusParams struct {
	InspectionID uuid.UUID `json:"inspection_id"`
	Status       string    `json:"status"`
}

func (q *Queries) CountViolationsByStatus(ctx context.Context, arg CountViolationsByStatusParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, countViolationsByStatus, arg.InspectionID, arg.Status)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countViolationsByUserID = `-- name: CountViolationsByUserID :one
SELECT COUNT(*) FROM violations v
JOIN inspections i ON i.id = v.inspection_id
WHERE i.user_id = $1
`

func (q *Queries) CountViolationsByUserID(ctx context.Context, userID uuid.UUID) (int64, error) {
	row := q.db.QueryRowContext(ctx, countViolationsByUserID, userID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createViolation = `-- name: CreateViolation :one
INSERT INTO violations (
    inspection_id,
    image_id,
    description,
    ai_description,
    confidence,
    bounding_box,
    status,
    severity,
    inspector_notes,
    sort_order
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9, $10
)
RETURNING id, inspection_id, image_id, description, ai_description, confidence, bounding_box, status, severity, inspector_notes, sort_order, created_at, updated_at
`

type CreateViolationParams struct {
	InspectionID   uuid.UUID             `json:"inspection_id"`
	ImageID        uuid.NullUUID         `json:"image_id"`
	Description    string                `json:"description"`
	AiDescription  sql.NullString        `json:"ai_description"`
	Confidence     sql.NullString        `json:"confidence"`
	BoundingBox    pqtype.NullRawMessage `json:"bounding_box"`
	Status         string                `json:"status"`
	Severity       sql.NullString        `json:"severity"`
	InspectorNotes sql.NullString        `json:"inspector_notes"`
	SortOrder      sql.NullInt32         `json:"sort_order"`
}

func (q *Queries) CreateViolation(ctx context.Context, arg CreateViolationParams) (Violation, error) {
	row := q.db.QueryRowContext(ctx, createViolation,
		arg.InspectionID,
		arg.ImageID,
		arg.Description,
		arg.AiDescription,
		arg.Confidence,
		arg.BoundingBox,
		arg.Status,
		arg.Severity,
		arg.InspectorNotes,
		arg.SortOrder,
	)
	var i Violation
	err := row.Scan(
		&i.ID,
		&i.InspectionID,
		&i.ImageID,
		&i.Description,
		&i.AiDescription,
		&i.Confidence,
		&i.BoundingBox,
		&i.Status,
		&i.Severity,
		&i.InspectorNotes,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteViolation = `-- name: DeleteViolation :exec
DELETE FROM violations
WHERE id = $1
`

func (q *Queries) DeleteViolation(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.ExecContext(ctx, deleteViolation, id)
	return err
}

const deleteViolationByIDAndUserID = `-- name: DeleteViolationByIDAndUserID :exec
DELETE FROM violations v
USING inspections i
WHERE v.id = $1
AND v.inspection_id = i.id
AND i.user_id = $2
`

type DeleteViolationByIDAndUserIDParams struct {
	ID     uuid.UUID `json:"id"`
	UserID uuid.UUID `json:"user_id"`
}

func (q *Queries) DeleteViolationByIDAndUserID(ctx context.Context, arg DeleteViolationByIDAndUserIDParams) error {
	_, err := q.db.ExecContext(ctx, deleteViolationByIDAndUserID, arg.ID, arg.UserID)
	return err
}

const getViolationByID = `-- name: GetViolationByID :one
SELECT id, inspection_id, image_id, description, ai_description, confidence, bounding_box, status, severity, inspector_notes, sort_order, created_at, updated_at FROM violations
WHERE id = $1
`

func (q *Queries) GetViolationByID(ctx context.Context, id uuid.UUID) (Violation, error) {
	row := q.db.QueryRowContext(ctx, getViolationByID, id)
	var i Violation
	err := row.Scan(
		&i.ID,
		&i.InspectionID,
		&i.ImageID,
		&i.Description,
		&i.AiDescription,
		&i.Confidence,
		&i.BoundingBox,
		&i.Status,
		&i.Severity,
		&i.InspectorNotes,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getViolationByIDAndInspectionID = `-- name: GetViolationByIDAndInspectionID :one
SELECT id, inspection_id, image_id, description, ai_description, confidence, bounding_box, status, severity, inspector_notes, sort_order, created_at, updated_at FROM violations
WHERE id = $1 AND inspection_id = $2
`

type GetViolationByIDAndInspectionIDParams struct {
	ID           uuid.UUID `json:"id"`
	InspectionID uuid.UUID `json:"inspection_id"`
}

func (q *Queries) GetViolationByIDAndInspectionID(ctx context.Context, arg GetViolationByIDAndInspectionIDParams) (Violation, error) {
	row := q.db.QueryRowContext(ctx, getViolationByIDAndInspectionID, arg.ID, arg.InspectionID)
	var i Violation
	err := row.Scan(
		&i.ID,
		&i.InspectionID,
		&i.ImageID,
		&i.Description,
		&i.AiDescription,
		&i.Confidence,
		&i.BoundingBox,
		&i.Status,
		&i.Severity,
		&i.InspectorNotes,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getViolationByIDAndUserID = `-- name: GetViolationByIDAndUserID :one
SELECT v.id, v.inspection_id, v.image_id, v.description, v.ai_description, v.confidence, v.bounding_box, v.status, v.severity, v.inspector_notes, v.sort_order, v.created_at, v.updated_at FROM violations v
JOIN inspections i ON i.id = v.inspection_id
WHERE v.id = $1 AND i.user_id = $2
`

type GetViolationByIDAndUserIDParams struct {
	ID     uuid.UUID `json:"id"`
	UserID uuid.UUID `json:"user_id"`
}

func (q *Queries) GetViolationByIDAndUserID(ctx context.Context, arg GetViolationByIDAndUserIDParams) (Violation, error) {
	row := q.db.QueryRowContext(ctx, getViolationByIDAndUserID, arg.ID, arg.UserID)
	var i Violation
	err := row.Scan(
		&i.ID,
		&i.InspectionID,
		&i.ImageID,
		&i.Description,
		&i.AiDescription,
		&i.Confidence,
		&i.BoundingBox,
		&i.Status,
		&i.Severity,
		&i.InspectorNotes,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getViolationWithImage = `-- name: GetViolationWithImage :one
SELECT
    v.id, v.inspection_id, v.image_id, v.description, v.ai_description, v.confidence, v.bounding_box, v.status, v.severity, v.inspector_notes, v.sort_order, v.created_at, v.updated_at,
    i.thumbnail_key,
    i.original_filename
FROM violations v
LEFT JOIN images i ON i.id = v.image_id
WHERE v.id = $1
`

type GetViolationWithImageRow struct {
	ID               uuid.UUID             `json:"id"`
	InspectionID     uuid.UUID             `json:"inspection_id"`
	ImageID          uuid.NullUUID         `json:"image_id"`
	Description      string                `json:"description"`
	AiDescription    sql.NullString        `json:"ai_description"`
	Confidence       sql.NullString        `json:"confidence"`
	BoundingBox      pqtype.NullRawMessage `json:"bounding_box"`
	Status           string                `json:"status"`
	Severity         sql.NullString        `json:"severity"`
	InspectorNotes   sql.NullString        `json:"inspector_notes"`
	SortOrder        sql.NullInt32         `json:"sort_order"`
	CreatedAt        sql.NullTime          `json:"created_at"`
	UpdatedAt        sql.NullTime          `json:"updated_at"`
	ThumbnailKey     sql.NullString        `json:"thumbnail_key"`
	OriginalFilename sql.NullString        `json:"original_filename"`
}

func (q *Queries) GetViolationWithImage(ctx context.Context, id uuid.UUID) (GetViolationWithImageRow, error) {
	row := q.db.QueryRowContext(ctx, getViolationWithImage, id)
	var i GetViolationWithImageRow
	err := row.Scan(
		&i.ID,
		&i.InspectionID,
		&i.ImageID,
		&i.Description,
		&i.AiDescription,
		&i.Confidence,
		&i.BoundingBox,
		&i.Status,
		&i.Severity,
		&i.InspectorNotes,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.ThumbnailKey,
		&i.OriginalFilename,
	)
	return i, err
}

const listConfirmedViolationsByInspectionID = `-- name: ListConfirmedViolationsByInspectionID :many
SELECT id, inspection_id, image_id, description, ai_description, confidence, bounding_box, status, severity, inspector_notes, sort_order, created_at, updated_at FROM violations
WHERE inspection_id = $1
AND status = 'confirmed'
ORDER BY sort_order ASC, created_at ASC
`

func (q *Queries) ListConfirmedViolationsByInspectionID(ctx context.Context, inspectionID uuid.UUID) ([]Violation, error) {
	rows, err := q.db.QueryContext(ctx, listConfirmedViolationsByInspectionID, inspectionID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Violation{}
	for rows.Next() {
		var i Violation
		if err := rows.Scan(
			&i.ID,
			&i.InspectionID,
			&i.ImageID,
			&i.Description,
			&i.AiDescription,
			&i.Confidence,
			&i.BoundingBox,
			&i.Status,
			&i.Severity,
			&i.InspectorNotes,
			&i.SortOrder,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listConfirmedViolationsByInspectionIDAndUserID = `-- name: ListConfirmedViolationsByInspectionIDAndUserID :many
SELECT v.id, v.inspection_id, v.image_id, v.description, v.ai_description, v.confidence, v.bounding_box, v.status, v.severity, v.inspector_notes, v.sort_order, v.created_at, v.updated_at FROM violations v
JOIN inspections i ON i.id = v.inspection_id
WHERE v.inspection_id = $1
AND i.user_id = $2
AND v.status = 'confirmed'
ORDER BY v.sort_order ASC, v.created_at ASC
`

type ListConfirmedViolationsByInspectionIDAndUserIDParams struct {
	InspectionID uuid.UUID `json:"inspection_id"`
	UserID       uuid.UUID `json:"user_id"`
}

// List confirmed violations with user authorization check (defense in depth)
func (q *Queries) ListConfirmedViolationsByInspectionIDAndUserID(ctx context.Context, arg ListConfirmedViolationsByInspectionIDAndUserIDParams) ([]Violation, error) {
	rows, err := q.db.QueryContext(ctx, listConfirmedViolationsByInspectionIDAndUserID, arg.InspectionID, arg.UserID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Violation{}
	for rows.Next() {
		var i Violation
		if err := rows.Scan(
			&i.ID,
			&i.InspectionID,
			&i.ImageID,
			&i.Description,
			&i.AiDescription,
			&i.Confidence,
			&i.BoundingBox,
			&i.Status,
			&i.Severity,
			&i.InspectorNotes,
			&i.SortOrder,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listViolationsByInspectionID = `-- name: ListViolationsByInspectionID :many
SELECT id, inspection_id, image_id, description, ai_description, confidence, bounding_box, status, severity, inspector_notes, sort_order, created_at, updated_at FROM violations
WHERE inspection_id = $1
ORDER BY sort_order ASC, created_at ASC
`

func (q *Queries) ListViolationsByInspectionID(ctx context.Context, inspectionID uuid.UUID) ([]Violation, error) {
	rows, err := q.db.QueryContext(ctx, listViolationsByInspectionID, inspectionID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Violation{}
	for rows.Next() {
		var i Violation
		if err := rows.Scan(
			&i.ID,
			&i.InspectionID,
			&i.ImageID,
			&i.Description,
			&i.AiDescription,
			&i.Confidence,
			&i.BoundingBox,
			&i.Status,
			&i.Severity,
			&i.InspectorNotes,
			&i.SortOrder,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateViolationDescription = `-- name: UpdateViolationDescription :exec
UPDATE violations
SET description = $2,
    updated_at = NOW()
WHERE id = $1
`

type UpdateViolationDescriptionParams struct {
	ID          uuid.UUID `json:"id"`
	Description string    `json:"description"`
}

func (q *Queries) UpdateViolationDescription(ctx context.Context, arg UpdateViolationDescriptionParams) error {
	_, err := q.db.ExecContext(ctx, updateViolationDescription, arg.ID, arg.Description)
	return err
}

const updateViolationDetails = `-- name: UpdateViolationDetails :exec
UPDATE violations
SET description = $2,
    severity = $3,
    inspector_notes = $4,
    updated_at = NOW()
WHERE id = $1
`

type UpdateViolationDetailsParams struct {
	ID             uuid.UUID      `json:"id"`
	Description    string         `json:"description"`
	Severity       sql.NullString `json:"severity"`
	InspectorNotes sql.NullString `json:"inspector_notes"`
}

func (q *Queries) UpdateViolationDetails(ctx context.Context, arg UpdateViolationDetailsParams) error {
	_, err := q.db.ExecContext(ctx, updateViolationDetails,
		arg.ID,
		arg.Description,
		arg.Severity,
		arg.InspectorNotes,
	)
	return err
}

const updateViolationNotes = `-- name: UpdateViolationNotes :exec
UPDATE violations
SET inspector_notes = $2,
    updated_at = NOW()
WHERE id = $1
`

type UpdateViolationNotesParams struct {
	ID             uuid.UUID      `json:"id"`
	InspectorNotes sql.NullString `json:"inspector_notes"`
}

func (q *Queries) UpdateViolationNotes(ctx context.Context, arg UpdateViolationNotesParams) error {
	_, err := q.db.ExecContext(ctx, updateViolationNotes, arg.ID, arg.InspectorNotes)
	return err
}

const updateViolationSeverity = `-- name: UpdateViolationSeverity :exec
UPDATE violations
SET severity = $2,
    updated_at = NOW()
WHERE id = $1
`

type UpdateViolationSeverityParams struct {
	ID       uuid.UUID      `json:"id"`
	Severity sql.NullString `json:"severity"`
}

func (q *Queries) UpdateViolationSeverity(ctx context.Context, arg UpdateViolationSeverityParams) error {
	_, err := q.db.ExecContext(ctx, updateViolationSeverity, arg.ID, arg.Severity)
	return err
}

const updateViolationStatus = `-- name: UpdateViolationStatus :exec
UPDATE violations
SET status = $2,
    updated_at = NOW()
WHERE id = $1
`

type UpdateViolationStatusParams struct {
	ID     uuid.UUID `json:"id"`
	Status string    `json:"status"`
}

func (q *Queries) UpdateViolationStatus(ctx context.Context, arg UpdateViolationStatusParams) error {
	_, err := q.db.ExecContext(ctx, updateViolationStatus, arg.ID, arg.Status)
	return err
}
