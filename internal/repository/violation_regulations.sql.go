// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: violation_regulations.sql

package repository

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
)

const addRegulationToViolation = `-- name: AddRegulationToViolation :one
INSERT INTO violation_regulations (
    violation_id,
    regulation_id,
    relevance_score,
    ai_explanation,
    is_primary
) VALUES (
    $1, $2, $3, $4, $5
)
ON CONFLICT (violation_id, regulation_id) DO NOTHING
RETURNING id, violation_id, regulation_id, relevance_score, ai_explanation, is_primary, created_at
`

type AddRegulationToViolationParams struct {
	ViolationID    uuid.UUID       `json:"violation_id"`
	RegulationID   uuid.UUID       `json:"regulation_id"`
	RelevanceScore sql.NullFloat64 `json:"relevance_score"`
	AiExplanation  sql.NullString  `json:"ai_explanation"`
	IsPrimary      sql.NullBool    `json:"is_primary"`
}

func (q *Queries) AddRegulationToViolation(ctx context.Context, arg AddRegulationToViolationParams) (ViolationRegulation, error) {
	row := q.db.QueryRowContext(ctx, addRegulationToViolation,
		arg.ViolationID,
		arg.RegulationID,
		arg.RelevanceScore,
		arg.AiExplanation,
		arg.IsPrimary,
	)
	var i ViolationRegulation
	err := row.Scan(
		&i.ID,
		&i.ViolationID,
		&i.RegulationID,
		&i.RelevanceScore,
		&i.AiExplanation,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const createViolationRegulation = `-- name: CreateViolationRegulation :one
INSERT INTO violation_regulations (
    violation_id,
    regulation_id,
    relevance_score,
    ai_explanation,
    is_primary
) VALUES (
    $1, $2, $3, $4, $5
)
RETURNING id, violation_id, regulation_id, relevance_score, ai_explanation, is_primary, created_at
`

type CreateViolationRegulationParams struct {
	ViolationID    uuid.UUID       `json:"violation_id"`
	RegulationID   uuid.UUID       `json:"regulation_id"`
	RelevanceScore sql.NullFloat64 `json:"relevance_score"`
	AiExplanation  sql.NullString  `json:"ai_explanation"`
	IsPrimary      sql.NullBool    `json:"is_primary"`
}

func (q *Queries) CreateViolationRegulation(ctx context.Context, arg CreateViolationRegulationParams) (ViolationRegulation, error) {
	row := q.db.QueryRowContext(ctx, createViolationRegulation,
		arg.ViolationID,
		arg.RegulationID,
		arg.RelevanceScore,
		arg.AiExplanation,
		arg.IsPrimary,
	)
	var i ViolationRegulation
	err := row.Scan(
		&i.ID,
		&i.ViolationID,
		&i.RegulationID,
		&i.RelevanceScore,
		&i.AiExplanation,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const deleteViolationRegulationsByViolationID = `-- name: DeleteViolationRegulationsByViolationID :exec
DELETE FROM violation_regulations
WHERE violation_id = $1
`

func (q *Queries) DeleteViolationRegulationsByViolationID(ctx context.Context, violationID uuid.UUID) error {
	_, err := q.db.ExecContext(ctx, deleteViolationRegulationsByViolationID, violationID)
	return err
}

const getViolationRegulation = `-- name: GetViolationRegulation :one
SELECT id, violation_id, regulation_id, relevance_score, ai_explanation, is_primary, created_at FROM violation_regulations
WHERE violation_id = $1 AND regulation_id = $2
`

type GetViolationRegulationParams struct {
	ViolationID  uuid.UUID `json:"violation_id"`
	RegulationID uuid.UUID `json:"regulation_id"`
}

func (q *Queries) GetViolationRegulation(ctx context.Context, arg GetViolationRegulationParams) (ViolationRegulation, error) {
	row := q.db.QueryRowContext(ctx, getViolationRegulation, arg.ViolationID, arg.RegulationID)
	var i ViolationRegulation
	err := row.Scan(
		&i.ID,
		&i.ViolationID,
		&i.RegulationID,
		&i.RelevanceScore,
		&i.AiExplanation,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const listRegulationsByViolationID = `-- name: ListRegulationsByViolationID :many
SELECT
    r.id, r.standard_number, r.title, r.category, r.subcategory, r.full_text, r.summary, r.severity_typical, r.parent_standard, r.effective_date, r.last_updated, r.search_vector, r.created_at, r.updated_at,
    vr.relevance_score,
    vr.ai_explanation,
    vr.is_primary
FROM violation_regulations vr
JOIN regulations r ON r.id = vr.regulation_id
WHERE vr.violation_id = $1
ORDER BY vr.is_primary DESC, vr.relevance_score DESC
`

type ListRegulationsByViolationIDRow struct {
	ID              uuid.UUID       `json:"id"`
	StandardNumber  string          `json:"standard_number"`
	Title           string          `json:"title"`
	Category        string          `json:"category"`
	Subcategory     sql.NullString  `json:"subcategory"`
	FullText        string          `json:"full_text"`
	Summary         sql.NullString  `json:"summary"`
	SeverityTypical sql.NullString  `json:"severity_typical"`
	ParentStandard  sql.NullString  `json:"parent_standard"`
	EffectiveDate   sql.NullTime    `json:"effective_date"`
	LastUpdated     sql.NullTime    `json:"last_updated"`
	SearchVector    interface{}     `json:"search_vector"`
	CreatedAt       sql.NullTime    `json:"created_at"`
	UpdatedAt       sql.NullTime    `json:"updated_at"`
	RelevanceScore  sql.NullFloat64 `json:"relevance_score"`
	AiExplanation   sql.NullString  `json:"ai_explanation"`
	IsPrimary       sql.NullBool    `json:"is_primary"`
}

func (q *Queries) ListRegulationsByViolationID(ctx context.Context, violationID uuid.UUID) ([]ListRegulationsByViolationIDRow, error) {
	rows, err := q.db.QueryContext(ctx, listRegulationsByViolationID, violationID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListRegulationsByViolationIDRow{}
	for rows.Next() {
		var i ListRegulationsByViolationIDRow
		if err := rows.Scan(
			&i.ID,
			&i.StandardNumber,
			&i.Title,
			&i.Category,
			&i.Subcategory,
			&i.FullText,
			&i.Summary,
			&i.SeverityTypical,
			&i.ParentStandard,
			&i.EffectiveDate,
			&i.LastUpdated,
			&i.SearchVector,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RelevanceScore,
			&i.AiExplanation,
			&i.IsPrimary,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeRegulationFromViolation = `-- name: RemoveRegulationFromViolation :exec
DELETE FROM violation_regulations
WHERE violation_id = $1 AND regulation_id = $2
`

type RemoveRegulationFromViolationParams struct {
	ViolationID  uuid.UUID `json:"violation_id"`
	RegulationID uuid.UUID `json:"regulation_id"`
}

func (q *Queries) RemoveRegulationFromViolation(ctx context.Context, arg RemoveRegulationFromViolationParams) error {
	_, err := q.db.ExecContext(ctx, removeRegulationFromViolation, arg.ViolationID, arg.RegulationID)
	return err
}
